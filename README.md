# Mini-UberEats (????? CQRS + Event-Driven + MassTransit + RabbitMQ)

????? ???

?????? ????? ??? ?????? ?? ?????? ?????? ?? ????????????? ???????????: ????? ????? ???????, ????? ???????, ????? ???? ??Read Model ?????? ????? ??????. ?? ??????? ??? ???????? ??? ??????? RabbitMQ + MassTransit. ??????? ????? ?`.NET 10` ??????? ?????? ?? SQLite ??? ????? (????? ?????) ??RabbitMQ ??? Docker.

?? ?????

- `Orders.Api` – ASP.NET Core Minimal API (?????)
  - ?????? ???: `POST /orders`, `GET /orders/{id}`, `POST /orders/{id}/cancel`
  - ???? Write DB (SQLite) ?????? `OrderCreated` / `OrderCancelled`
- `Payments.Worker` – Worker service
  - ????? ??`OrderCreated`, ???? ????? ??? ????? `PaymentSucceeded` ?? `PaymentFailed`
- `Kitchen.Worker` – Worker service
  - ????? ??`PaymentSucceeded`, ???? ???? ?????? `OrderPrepared`
- `ReadModel.Worker` – Worker service
  - ????? ??? ???????? ?????? ?? ??Read DB ????? ??Queries
- `Contracts` – ?????? ???? ?????? (Events / DTOs)

???? ?????? ??????

1. ??? ??? ?? `.NET 10 SDK` ??`Docker` ?????.
2. ???? ?? RabbitMQ (???? ????? ???????):

   `docker-compose up -d`

   (????? `docker-compose.yml` ??????? ????? ????? `rabbitmq` ?? ?????? `5672` ??`15672`).

3. ??? ?? ?????? ??API ???Workers ??????? ?????? ?? ??????? Visual Studio / VS Code:

   - ???? `src/Orders.Api`: `dotnet run`
   - ???? `src/Payments.Worker`: `dotnet run`
   - ???? `src/Kitchen.Worker`: `dotnet run`
   - ???? `src/ReadModel.Worker`: `dotnet run`

????: ???? ????? ?? `Orders.Api` ??? ??? ???Workers ????? ?????? ???????; ?? ??? ??? ????? ????? ???? ??? ?? ????.

??????? ????? ????? (curl)

- ??? ?????:

  `curl -X POST http://localhost:5000/orders -H "Content-Type: application/json" -d '{"customerName":"Aya","items":["Pizza"],"totalAmount":39.99}'`

  ????? `orderId` ??????.

- ??? ?????:

  `curl http://localhost:5000/orders/{orderId}`

- ??? ?????:

  `curl -X POST http://localhost:5000/orders/{orderId}/cancel -H "Content-Type: application/json" -d '{"reason":"Customer requested"}'`

???? ?????? (Events) ???????

- `OrderCreated` (OrderId, CustomerName, TotalAmount, CreatedAt)
- `PaymentSucceeded` (OrderId, PaymentId, PaidAt)
- `PaymentFailed` (OrderId, Reason, FailedAt)
- `OrderPrepared` (OrderId, PreparedAt)
- `OrderCancelled` (OrderId, Reason, CancelledAt)

??????? ?????? ????? ????? ???

- CQRS: ????? ??`Orders.Api`, ????? ???Read DB ?????? `ReadModel.Worker`.
- Idempotency: ??? ????? ????? ??????? ?????? ??????.
- CorrelationId: ?????? `OrderId` ??? ????? ?????? ????? ?????.
- Retries/DLQ: MassTransit ??RabbitMQ ?????? ?????? retry/backoff ??error queues.

????? ??????

- `docker-compose.yml` – ????? RabbitMQ.
- `mini-uberEats/Program.cs`, `Controllers/OrdersController.cs`, `Infrastructure/OrdersDbContext.cs` – ?????? ????? ??API.

????? ?????? ?????

1. ?? ???? — ???? ????? ??? ?????? ??? ?? `Contracts` ??Consumers/Producers ???????.
2. ???? ?????? Outbox Pattern ??`Orders.Api` ??? ?????? "????? + ?????" ??????.
3. ???? ?????? ???????? ????? ???????? (PowerShell/Makefile) ????? ?? ????????.

?? ???? ?????? ????? ???? ??? (contracts + minimal consumers + API endpoints), ???? ???? ????? ??????.`